<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.EmpDao">
 	
 	<!-- 전체 직원 수 조회 -->
 	<select id="getTotalCount" resultType="int">
 		SELECT COUNT(*) FROM EMP
 	</select>
 	
 	<!-- 조건별 직원 수 조회 -->
 	<select id="getCount" resultType="int">
 		SELECT COUNT(*) FROM EMP
 		<where>
 			<if test="field != null and query != null and query != ''">
 				<choose>
 					<when test="field == 'ename'">
 						AND ENAME LIKE '%' || #{query} || '%'
 					</when>
 					<when test="field == 'job'">
 						AND JOB LIKE '%' || #{query} || '%'
 					</when>
 					<when test="field == 'deptno'">
 						AND DEPTNO = #{query}
 					</when>
 				</choose>
 			</if>
 		</where>
 	</select>
 	
 	<!-- 전체 직원 목록 조회 -->
 	<select id="getAllEmps" resultType="vo.Emp">
 		SELECT * FROM EMP
 		ORDER BY EMPNO
 	</select>
 	
 	<!-- 페이징 및 검색 조건으로 직원 목록 조회 -->
 	<select id="getEmps" resultType="vo.Emp">
 		SELECT * FROM (
 			SELECT ROWNUM no, t.* FROM (
 				SELECT * FROM EMP
 				<where>
 					<if test="field != null and query != null and query != ''">
 						<choose>
 							<when test="field == 'ename'">
 								AND ENAME LIKE '%' || #{query} || '%'
 							</when>
 							<when test="field == 'job'">
 								AND JOB LIKE '%' || #{query} || '%'
 							</when>
 							<when test="field == 'deptno'">
 								AND DEPTNO = #{query}
 							</when>
 						</choose>
 					</if>
 				</where>
 				ORDER BY EMPNO DESC
 			) t
 		)
 		<![CDATA[
 		WHERE no BETWEEN (#{page}-1)*10+1 AND #{page}*10
 		]]>
 	</select>
 	
 	<!-- 특정 직원 상세 조회 -->
 	<select id="getEmp" resultType="vo.Emp">
 		SELECT * FROM EMP
 		WHERE EMPNO = #{empno}
 	</select>
 	
 	<!-- 부서별 직원 조회 -->
 	<select id="getEmpsByDeptno" resultType="vo.Emp">
 		SELECT * FROM EMP
 		WHERE DEPTNO = #{deptno}
 		ORDER BY EMPNO
 	</select>
 	
 	<!-- 직책별 직원 조회 -->
 	<select id="getEmpsByJob" resultType="vo.Emp">
 		SELECT * FROM EMP
 		WHERE JOB = #{job}
 		ORDER BY EMPNO
 	</select>
 	
 	<!-- 급여 범위로 직원 조회 -->
 	<select id="getEmpsBySalRange" resultType="vo.Emp">
 		SELECT * FROM EMP
 		<![CDATA[
 		WHERE SAL BETWEEN #{minSal} AND #{maxSal}
 		]]>
 		ORDER BY SAL DESC
 	</select>
 	
 	<!-- 직원 등록 -->
 	<insert id="insert">
 		INSERT INTO EMP (
 			EMPNO, ENAME, JOB, MGR,
 			HIREDATE, SAL, COMM, DEPTNO
 		) VALUES (
 			#{empno}, #{ename}, #{job}, #{mgr, jdbcType=NUMERIC},
 			#{hiredate}, #{sal}, #{comm, jdbcType=NUMERIC}, #{deptno}
 		)
 	</insert>
 	
 	<!-- 직원 정보 수정 -->
 	<update id="update">
 		UPDATE EMP
 		<set>
 			<if test="ename != null">ENAME = #{ename},</if>
 			<if test="job != null">JOB = #{job},</if>
 			<if test="mgr != null">MGR = #{mgr},</if>
 			<if test="hiredate != null">HIREDATE = #{hiredate},</if>
 			<if test="sal != null">SAL = #{sal},</if>
 			<if test="comm != null">COMM = #{comm},</if>
 			<if test="deptno != null">DEPTNO = #{deptno}</if>
 		</set>
 		WHERE EMPNO = #{empno}
 	</update>
 	
 	<!-- 급여 인상 -->
 	<update id="updateSalary">
 		UPDATE EMP
 		SET SAL = SAL + #{increaseAmount}
 		WHERE EMPNO = #{empno}
 	</update>
 	
 	<!-- 부서 이동 -->
 	<update id="updateDepartment">
 		UPDATE EMP
 		SET DEPTNO = #{deptno}
 		WHERE EMPNO = #{empno}
 	</update>
 	
 	<!-- 직원 삭제 -->
 	<delete id="delete">
 		DELETE FROM EMP
 		WHERE EMPNO = #{empno}
 	</delete>
 	
 	<!-- 부서별 직원 삭제 -->
 	<delete id="deleteByDeptno">
 		DELETE FROM EMP
 		WHERE DEPTNO = #{deptno}
 	</delete>
 	
 	<!-- 부서별 평균 급여 조회 -->
 	<select id="getAvgSalByDept" resultType="double">
 		SELECT NVL(AVG(SAL), 0) FROM EMP
 		WHERE DEPTNO = #{deptno}
 	</select>
 	
 	<!-- 부서별 직원 수 조회 -->
 	<select id="getCountByDept" resultType="int">
 		SELECT COUNT(*) FROM EMP
 		WHERE DEPTNO = #{deptno}
 	</select>
 	
 	<!-- 사원번호 중복 체크 -->
 	<select id="existsEmpno" resultType="boolean">
 		SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
 		FROM EMP
 		WHERE EMPNO = #{empno}
 	</select>

</mapper>